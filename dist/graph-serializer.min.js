!function(e){if("object"==typeof module&&"object"==typeof module.exports){var i=e(require,exports);void 0!==i&&(module.exports=i)}else"function"==typeof define&&define.amd&&define(["require","exports"],e)}(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){this.serializer=function(e){return e},this.deserializer=function(e){return e}};t.Scheme=r;var n=function(){function e(e,i){void 0===i&&(i={}),this.direction=["serialize","deserialize"],this.name=e,this.setDecoration(i)}return e.prototype.setDecoration=function(e){return this.scheme=e.scheme||new r,this.serializedName=e.serializedName||this.name,this.direction=e.direction||this.direction,this},e}();t.PropertyDescription=n;var o=function(){function e(e){var i=this;this.classConstructor=e,this.deserializationFactory=function(e){return new i.classConstructor},this.properties=new Map}return e.prototype.setDecoration=function(e){return void 0===e||(this.postDeserialize=e.postDeserialize||void 0),this},e}();t.ClassDescription=o;var i,s=function(){function e(){this.map=new Map}return e.prototype.get=function(e){return this.map.has(e)||this.map.set(e,new o(e)),this.map.get(e)},e.prototype.set=function(e,i){this.map.set(e,i)},e}(),a=new(t.Store=s);function c(e,i){if(null===i)return null;var t=l(e),r=t.deserializationFactory(i);return t.properties.forEach(function(e){void 0!==i[e.serializedName]&&-1!==e.direction.indexOf("deserialize")&&(r[e.name]=e.scheme.deserializer(i[e.serializedName]))}),"function"==typeof t.postDeserialize&&t.postDeserialize(r),r}function u(i){if(null===i)return null;if(Object.getPrototypeOf(i)===Object.prototype)return i;var t={};return l(Object.getPrototypeOf(i).constructor).properties.forEach(function(e){-1!==e.direction.indexOf("serialize")&&(t[e.serializedName]=e.scheme.serializer(i[e.name]))}),t}function l(e){var i=e,t=new o(e);do{var r=a.get(i);i===e&&(t.deserializationFactory=r.deserializationFactory),t.postDeserialize=t.postDeserialize||r.postDeserialize,r.properties.forEach(function(e){t.properties.has(e.serializedName)||t.properties.set(e.serializedName,e)})}while((i=Object.getPrototypeOf(i))instanceof Function);return t}t.deserialize=c,t.serialize=u,t.primitive=new r,t.date=((i=new r).serializer=function(e){return e instanceof Date?e.toJSON():e},i.deserializer=function(e){return"string"==typeof e?new Date(e):e},i),t.array=function(i){void 0===i&&(i=t.primitive);var e=new r;return e.serializer=function(e){return e.map(function(e){return i.serializer(e)})},e.deserializer=function(e){return void 0===e?e:e.map(function(e){return i.deserializer(e)})},e},t.object=function(i){var e=new r;return e.serializer=function(e){return u(e)},e.deserializer=function(e){return c(i,e)},e},t.custom=function(e,i){var t=new r;return t.serializer=e,t.deserializer=i,t},t.serializable=function(t){return void 0===t&&(t={}),function(e,i){if(1===arguments.length)a.get(e).setDecoration(t);else{if(3!==arguments.length)throw new Error("Invalid decorator");a.get(e.constructor).properties.set(i,new n(i,t))}}},t.postDeserialize=function(){return function(e,i,t){if(3!==arguments.length)throw new Error("Invalid decorator");var r=a.get(e);r.postDeserialize=t.value,a.set(e,r)}},t.deserializationFactory=function(){return function(e,i,t){if(3!==arguments.length)throw new Error("Invalid decorator");var r=a.get(e);r.deserializationFactory=t.value,a.set(e,r)}}});