!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports"],e)}(function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){this.serializer=function(e){return e},this.deserializer=function(e){return e}};r.Scheme=i;var n=function(){function e(e,t){void 0===t&&(t={}),this.direction=["serialize","deserialize"],this.name=e,this.setDecoration(t)}return e.prototype.setDecoration=function(e){return this.scheme=e.scheme||new i,this.serializedName=e.serializedName||this.name,this.direction=e.direction||this.direction,this},e}();r.PropertyDescription=n;var t=function(){function e(e){var t=this;this.classConstructor=e,this.postDeserialize=function(){},this.deserializationFactory=function(e){return new t.classConstructor},this.properties=new Map}return e.prototype.setDecoration=function(e){return void 0===e||(this.postDeserialize=void 0===e.postDeserialize?function(){}:e.postDeserialize),this},e}();r.ClassDescription=t;var o,s=function(){function e(){this.map=new Map}return e.prototype.get=function(e){return this.map.has(e)||this.map.set(e,new t(e)),this.map.get(e)},e.prototype.set=function(e,t){this.map.set(e,t)},e}(),a=new(r.Store=s);function c(e,r){if(null===r)return null;var t=a.get(e),i=t.deserializationFactory(r);if(Object.getPrototypeOf(e)instanceof Function){var n=Object.getPrototypeOf(Object.getPrototypeOf(i)).constructor;Object.assign(i,c(n,r))}return t.properties.forEach(function(e,t){void 0!==r[e.serializedName]&&-1!==e.direction.indexOf("deserialize")&&(i[t]=e.scheme.deserializer(r[e.serializedName]))}),t.postDeserialize(i),i}function u(r){var i={};if(null===r)return null;if(Object.getPrototypeOf(r)===Object.prototype)return r;if(null!==Object.getPrototypeOf(Object.getPrototypeOf(r))&&Object.getPrototypeOf(Object.getPrototypeOf(r)).constructor!==Object){var e=new(Object.getPrototypeOf(Object.getPrototypeOf(r)).constructor);Object.assign(e,r),Object.assign(i,u(e))}return a.get(Object.getPrototypeOf(r).constructor).properties.forEach(function(e,t){-1!==e.direction.indexOf("serialize")&&(i[e.serializedName]=e.scheme.serializer(r[t]))}),i}r.deserialize=c,r.serialize=u,r.primitive=new i,r.date=((o=new i).serializer=function(e){return e instanceof Date?e.toJSON():e},o.deserializer=function(e){return"string"==typeof e?new Date(e):e},o),r.array=function(t){void 0===t&&(t=r.primitive);var e=new i;return e.serializer=function(e){return e.map(function(e){return t.serializer(e)})},e.deserializer=function(e){return void 0===e?e:e.map(function(e){return t.deserializer(e)})},e},r.object=function(t){var e=new i;return e.serializer=function(e){return u(e)},e.deserializer=function(e){return c(t,e)},e},r.custom=function(e,t){var r=new i;return r.serializer=e,r.deserializer=t,r},r.serializable=function(r){return void 0===r&&(r={}),function(e,t){if(1===arguments.length)a.get(e).setDecoration(r);else{if(3!==arguments.length)throw new Error("Invalid decorator");a.get(e.constructor).properties.set(t,new n(t,r))}}},r.postDeserialize=function(){return function(e,t,r){if(3!==arguments.length)throw new Error("Invalid decorator");var i=a.get(e);i.postDeserialize=r.value,a.set(e,i)}},r.deserializationFactory=function(){return function(e,t,r){if(3!==arguments.length)throw new Error("Invalid decorator");var i=a.get(e);i.deserializationFactory=r.value,a.set(e,i)}}});