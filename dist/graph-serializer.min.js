!function(e){if("object"==typeof module&&"object"==typeof module.exports){var r=e(require,exports);void 0!==r&&(module.exports=r)}else"function"==typeof define&&define.amd&&define(["require","exports"],e)}(function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){this.serializer=function(e){return e},this.deserializer=function(e){return e}};i.Scheme=n;var t=function(){function e(e,r){void 0===r&&(r={}),this.direction=["serialize","deserialize"],this.name=e,this.setDecoration(r)}return e.prototype.setDecoration=function(e){return this.scheme=e.scheme||new n,this.serializedName=e.serializedName||this.name,this.direction=e.direction||this.direction,this},e}();i.PropertyDescription=t;var o=function(){function e(e){var r=this;this.classConstructor=e,this.deserializationFactory=function(e){return new r.classConstructor},this.properties=new Map}return e.prototype.setDecoration=function(e){return void 0===e||(this.postDeserialize=e.postDeserialize||void 0),this},e}();i.ClassDescription=o;var r,a=function(){function e(){this.map=new Map}return e.prototype.get=function(e){return this.map.has(e)||this.map.set(e,new o(e)),this.map.get(e)},e.prototype.set=function(e,r){this.map.set(e,r)},e}(),s=new(i.Store=a);function u(e,r){if(null===r)return null;var i=f(e),t=i.deserializationFactory(r);return i.properties.forEach(function(e){void 0!==r[e.serializedName]&&-1!==e.direction.indexOf("deserialize")&&(t[e.name]=e.scheme.deserializer(r[e.serializedName]))}),"function"==typeof i.postDeserialize&&i.postDeserialize(t),t}function c(r){if(null===r)return null;if(Object.getPrototypeOf(r)===Object.prototype)return r;var i={};return f(Object.getPrototypeOf(r).constructor).properties.forEach(function(e){-1!==e.direction.indexOf("serialize")&&(i[e.serializedName]=e.scheme.serializer(r[e.name]))}),i}function f(e){var r=e,i=new o(e);do{var t=s.get(r);r===e&&(i.deserializationFactory=t.deserializationFactory),i.postDeserialize=i.postDeserialize||t.postDeserialize,t.properties.forEach(function(e){i.properties.has(e.serializedName)||i.properties.set(e.serializedName,e)})}while((r=Object.getPrototypeOf(r))instanceof Function);return i}i.deserialize=u,i.serialize=c,i.primitive=new n,i.date=((r=new n).serializer=function(e){return e instanceof Date?e.toJSON():e},r.deserializer=function(e){return"string"==typeof e?new Date(e):e},r),i.array=function(r){void 0===r&&(r=i.primitive);var e=new n;return e.serializer=function(e){return e.map(function(e){return r.serializer(e)})},e.deserializer=function(e){return void 0===e?e:e.map(function(e){return r.deserializer(e)})},e},i.objectMap=function(t){void 0===t&&(t=i.primitive);var e=new n;return e.serializer=function(e){if(void 0===e||"object"!=typeof e)return e;var r={};for(var i in e)!0===e.hasOwnProperty(i)&&(r[i]=t.serializer(e[i]));return r},e.deserializer=function(e){if(void 0===e||"object"!=typeof e)return e;var r={};for(var i in e)!0===e.hasOwnProperty(i)&&(r[i]=t.deserializer(e[i]));return r},e},i.object=function(r){var e=new n;return e.serializer=function(e){return c(e)},e.deserializer=function(e){return u(r,e)},e},i.custom=function(e,r){var i=new n;return i.serializer=e,i.deserializer=r,i},i.serializable=function(i){return void 0===i&&(i={}),function(e,r){if(1===arguments.length)s.get(e).setDecoration(i);else{if(3!==arguments.length)throw new Error("Invalid decorator");s.get(e.constructor).properties.set(r,new t(r,i))}}},i.postDeserialize=function(){return function(e,r,i){if(3!==arguments.length)throw new Error("Invalid decorator");var t=s.get(e);t.postDeserialize=i.value,s.set(e,t)}},i.deserializationFactory=function(){return function(e,r,i){if(3!==arguments.length)throw new Error("Invalid decorator");var t=s.get(e);t.deserializationFactory=i.value,s.set(e,t)}}});